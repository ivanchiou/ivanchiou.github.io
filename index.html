<!DOCTYPE html>
<html>
    <head>
        <title>Ivan's Personal Website</title>
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
        <meta name="viewport" content="width=device-width,initial-scale=1" />
        <meta name="description" content="Ivan's Personal Website">
        <link rel="icon" type="image/png" href="images/pineapple_bun.png">
        <meta property="og:url"  content="https://ivanchiou.github.io/" />
        <meta property="og:type"   content="website" />
        <meta property="og:title"   content="Ivan's Personal Website" />
        <meta property="og:description"  content="Ivan's Personal Website Description" />
        <meta property="og:image" content="https://ivanchiou.github.io/images/pineapple_bun_large.png" />
        <meta name="location" content="St. Kitts and Nevis">
        <meta name="Author" content="Ivan's Personal Website">
        <meta name="Subject" content="Ivan's Personal Website">
        <meta name="Language" content="English">
        <meta name="Abstract" content="Ivan's Personal Website">
        <meta name="Copyright" content="Copyright 2021 by Ivan. All rights reversed.">
        <meta name="Designer" content="Ivan's Personal Website">
        <meta name="Publisher" content="Ivan's Personal Website">
        <meta name="Distribution" content="Global">
        <link rel="canonical" href="https://ivanchiou.github.io/">
        <link rel="stylesheet" href="css/style.min.css">
        <link rel="dns-prefetch" href="http://www.nevisrelaymarathon.com/">
        <link rel="dns-prefetch" href="https://ivanchiou.github.io/project.html">

        <link href="https://fonts.googleapis.com/css?family=Material+Icons|Material+Icons+Outlined|Material+Icons+Two+Tone|Material+Icons+Round|Material+Icons+Sharp" rel="stylesheet">
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.4/jquery.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-cookie/1.4.1/jquery.cookie.min.js"></script>
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.min.js" integrity="sha384-cVKIPhGWiC2Al4u+LWgxfKTRIcfu0JTxR+EQDz/bgldoEyl4H0zUF0QKbrJ0EcQF" crossorigin="anonymous"></script>
        <script type="application/ld+json">
            {
              "@context" : "http://schema.org",
              "@type" : "Product",
              "image" : "https://ivanchiou.github.io/images/pineapple_bun.png"
            }
        </script>
        <script defer src="js/script.min.js"></script>
        <script defer src="js/script_index.min.js"></script>
    </head>
    <body>
        <header>
        </header>
        <nav>
        </nav>
        <main>
            <div class="main-image slider">
                <img alt="slider-image" src="https://loremflickr.com/1600/300/food?lock=714" class="slider-item"/>
                <img alt="slider-image" src="https://loremflickr.com/1600/300/food?lock=715" class="slider-item"/>
                <img alt="slider-image" src="https://loremflickr.com/1600/300/food?lock=716" class="slider-item"/>
                <img alt="slider-image" src="https://loremflickr.com/1600/300/food?lock=717" class="slider-item"/>
                <img alt="slider-image" src="https://loremflickr.com/1600/300/food?lock=718" class="slider-item"/>
                <button class="slider-prev" onclick="prevImage()"><</button>
                <button class="slider-next" onclick="nextImage()">></button>
                <button class="slider-bingo spin" onclick="bingo()">SPIN</button>
            </div>
            <div class="main-content">
                <section>
                    <h1 class="d-none">Programmer</h1>
                    <article>
                        <h2>What is my background</h2>
                        <p>
                            My background is rich merchant. I have following cars:
                        </p>
                        <div id="items-layout" class="items-layout"></div>
                    </article>
                    <article>
                        <h2>Why I learn programming</h2>
                        <p>
                            Because I love it! Because I love it! Because I love it! Because I love it! Because I love it! Because I love it!
                        </p>
                    </article>
                </section>
                <aside>
                </aside>
            </div>
        </main>
        <footer>
        </footer>        
    </body>
    <!-- The core Firebase JS SDK is always required and must be listed first -->
    <script src="https://www.gstatic.com/firebasejs/8.7.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.7.1/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.7.1/firebase-database.js"></script>
    <!-- TODO: Add SDKs for Firebase products that you want to use
        https://firebase.google.com/docs/web/setup#available-libraries -->
    <script src="https://www.gstatic.com/firebasejs/8.7.1/firebase-analytics.js"></script>

    <script>
        // Your web app's Firebase configuration
        // For Firebase JS SDK v7.20.0 and later, measurementId is optional
        var firebaseConfig = {
            apiKey: "AIzaSyBi1TivKJ0aAsuoCh1pDEqHvu22YvKiGdY",
            authDomain: "contact-form-ed774.firebaseapp.com",
            databaseURL: "https://contact-form-ed774-default-rtdb.firebaseio.com",
            projectId: "contact-form-ed774",
            storageBucket: "contact-form-ed774.appspot.com",
            messagingSenderId: "3376266719",
            appId: "1:3376266719:web:ef951163f4174b5626d86a",
            measurementId: "G-DENRXVS6SX"
        };
        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        firebase.analytics();
    </script>    
    <script>
        let colorCategorySet = new Set();

        let currentPage = 1;
        let totalPage = 0;
        let totalItems = [];
        let currentColorFilter = "All";
        const numbersOfItemsInOnePage = 6;
        const items_layout = document.querySelector('#items-layout');

        function renderItems(items) {
            items_layout.innerHTML = '<div id="filter-division" class="filter-division"></div>'
            totalPage = Math.floor((items.length-1) / numbersOfItemsInOnePage) + 1
            items.forEach((item)=>{
                colorCategorySet.add(item.color);
            })

            const itemsOfPage = items.slice(numbersOfItemsInOnePage*(currentPage-1), numbersOfItemsInOnePage*currentPage);

            renderPagination("first-paginaion")

            itemsOfPage.forEach(function (item) {
                let item_html = "";
                item_html += '<div class="item">';
                item_html += '<div class="item-title">' + item.name + '</div>';
                item_html += '<div class="item-body">';
                item_html += '<div class="item-image"><img src="' + item.image_link + '"" /></div>';
                item_html += '</div>';
                item_html += '<div class="item-footer">'
                item_html += '<div class="item-attribute"><span>' + item.color.toUpperCase() + '</span><span> ' + item.description.toUpperCase() + '</span></div>';
                item_html += '<div>$' + item.price + '</div>';
                item_html += '</div>';
                item_html += '</div>';

                items_layout.innerHTML += item_html;
            })

            renderDataFilter()
            renderPagination()

            const elements = document.getElementsByClassName("item");
            for (let index = 0; index < elements.length; index++) {
                elements[index].onclick = function () {
                    alert(this.querySelector('.item-title').innerText);
                }
            }

            //location.href ="#items-layout";
        }

        function rerenderItemsByPage(page){
            currentPage = page;
            renderItems(totalItems);
        }

        function renderPagination(elementID="none") {
            items_layout.innerHTML += 
                        `<div id="${elementID}" class="pagination-division">
                            <ul class="pagination-element">
                                <li ${currentPage === 1 ? '': `onclick="rerenderItemsByPage(1)"`}><<</li>
                                <li ${currentPage === 1 ? '': `onclick="rerenderItemsByPage(${currentPage-1})"`} ><</li>
                                ${renderNumbersListOfPagination() }
                                <li ${currentPage === totalPage ? '': `onclick="rerenderItemsByPage(${currentPage+1})"`} >></li>
                                <li ${currentPage === totalPage ? '': `onclick="rerenderItemsByPage(${totalPage})"`} >>></li>
                            </ul>
                        </div>`
        }

        function renderNumbersListOfPagination () {
            let number_array = new Array(totalPage);
            for (let index=0; index<totalPage; index++) {
                number_array[index] = index+1;
            }
            return number_array.reduce((accumulator, currentValue)=> {
                return accumulator += `<li ${(currentPage === currentValue) ? 'class="active"':  `onclick="rerenderItemsByPage(${currentValue})"`} >${currentValue}</li>`
            }, "")
        }

        function rerenderItemsByColorFilter(color) {
            currentColorFilter = color;
            let filterItems = (currentColorFilter === "All") ? totalItems : totalItems.filter((item)=>{
                return item.color === color;
            })
            currentPage = 1;
            renderItems(filterItems);
        }

        function renderDataFilter() {
            const colorCategoryArray = Array.from(colorCategorySet)
            items_layout.innerHTML +=
                `<div id="filter-element" class="filter-element">
                    <span>Color:</span>
                    <select onchange="rerenderItemsByColorFilter(this.options[this.selectedIndex].value);">
                        <option value="All">All</option>
                        ${ colorCategoryArray.reduce((accumulator, currentValue, currentIndex)=>{
                            return accumulator += `<option value="${currentValue}" ${currentColorFilter === currentValue ? "selected":""}>${currentValue}</option>`
                        }, "")}
                    </select>
                </div>`
            document.getElementById('filter-division').appendChild(document.getElementById('filter-element'));
        }

        function readCSVFile(file) {
            fetch(file).then(function (response) {
                return response.text()
            }).then(function (data) {
                let items = []
                const header_string = data.split(/\n/)[0];
                const dataTable = data.split(/\n/).slice(1);
                dataTable.forEach(function (row) {
                    const headers = header_string.split(',');
                    const columns = row.split(',');
                    let item = {}
                    columns.forEach((col, index) => {
                        if (col) {
                            const key = headers[index].replace(/(\r\n|\n|\r)/gm, "");
                            item[key] = col.replace(/(\r\n|\n|\r)/gm, "");
                        }
                    })

                    items.push(item);
                })

                renderItems(items);
            })
        }

        function readJSONFile(file) {
            /*fetch(file).then(response => {
                return response.json();
            }).then(data => {
                totalItems = data.items;
                renderItems(totalItems);
            });*/
            $.get('https://contact-form-ed774-default-rtdb.firebaseio.com/items/.json',
            null,
                function (res) {
                    totalItems = Object.values(res);
                    renderItems(totalItems);
                }
            );
        }

        readJSONFile("seeders/data.json");

        $(document).ready(function() {
            /*if(!$.cookie("name") || $.cookie("name") === null) {
                let name = prompt("What is your name?", "Type your name here");
                $.cookie("name", name);
            }*/
        })
    </script>
</html>
